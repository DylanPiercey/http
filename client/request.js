var EventEmitter = require("events").EventEmitter;
var location     = window.history.location || window.location;
var referrer     = document.referrer;

function IncomingMessage (opts) {
	this.url                        = opts.url;
	this.method                     = opts.method || "GET";
	this.headers                    = opts.headers || {};
	this.headers["date"]            = (new Date()).toUTCString();
	this.headers["host"]            = location.host;
	this.headers["cookie"]          = document.cookie;
	this.headers["user-agent"]      = navigator.userAgent;
	this.headers["accept-language"] = navigator.language;
	this.headers["referer"]         = referrer;
	this.trailers                   = opts.trailers || {};
	this.connection                 = {
		remoteAddress: "127.0.0.1",
		encrypted: location.protocol === "https:"
	};
	this.body = opts.body;
	this.files = opts.files;
	referrer = opts.url;
}
var proto = IncomingMessage.prototype = Object.create(EventEmitter.prototype);

// Defaults
proto.httpVersionMajor = 1;
proto.httpVersionMinor = 1;
proto.httpVersion      = proto.httpVersionMajor + "." + proto.httpVersionMinor;
proto.complete         = false;


module.exports = IncomingMessage;